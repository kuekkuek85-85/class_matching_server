# 학생 프로그램 신청 및 배치 시스템 - 백엔드 API 서버

## 프로젝트 개요
해커톤용 학생 프로그램 신청 및 배치 시스템의 백엔드 API 서버입니다.
- 클라이언트는 별도 프로젝트로 분리되어 있으며, 이 프로젝트는 API만 제공합니다.
- 구글 폼 없이 웹에서 바로 프로그램 신청/배치를 처리합니다.

## 기술 스택
- **백엔드**: Node.js + Express
- **데이터베이스**: PostgreSQL (Replit 제공)
- **ORM**: Drizzle ORM
- **언어**: TypeScript

## 주요 기능
1. **프로그램 관리 API**
   - 프로그램 등록/조회/삭제
   
2. **학생 신청 API**
   - 최초 제출: 학번 + 이름만 필수
   - 중복 제출: 전화번호 + 생년월일 추가 필수
   - submission_count 자동 업데이트

3. **배치 API**
   - 개선된 배치 알고리즘:
     * 무작위 섞기 후 1~3지망 순으로 정원 채우기
     * **3지망까지 실패한 학생은 남은 정원 프로그램에 랜덤 배치**
     * 모든 학생 100% 배치 보장 (총 정원 충분 시)
   - 배치 결과 조회 (학생별 메시지 포함)
   - 개별 배치 수정 (정원 무시)
   - CSV 다운로드

## 데이터베이스 스키마
### programs
- id, name, type, quota, description, created_at

### applications
- id, student_id (UNIQUE), name, phone, birthdate
- choice_1, choice_2, choice_3
- submission_count, first_submitted_at, last_submitted_at

### allocations
- id, student_id, program_id, choice_rank, allocation_type, allocated_at

## API 엔드포인트
### 프로그램 관리
- `GET /api/programs` - 프로그램 목록 조회
- `POST /api/programs` - 프로그램 등록
- `DELETE /api/programs/:id` - 프로그램 삭제

### 학생 신청
- `POST /api/applications` - 신청 제출/재제출
- `GET /api/applications` - 신청 현황 조회

### 배치
- `POST /api/allocate` - 배치 실행 (개선된 알고리즘)
- `GET /api/allocate/results` - 배치 결과 조회 (학생별 메시지 포함)
- `PATCH /api/allocate/:id` - 개별 배치 수정 (정원 무시)
- `GET /api/allocate/export` - CSV 다운로드

## 개발 가이드라인
- **인증 없음**: MVP에서는 별도 로그인/인증 시스템 없이 구현
- **AI 배치 제외**: 기본 배치 알고리즘만 구현 (AI는 선택 사항)
- **클라이언트 분리**: 이 프로젝트는 API만 제공, 클라이언트는 별도 프로젝트
- **정원 제한 없음**: 배치 수정 시 정원 체크 제거됨

## 배치 알고리즘 상세
1. 학생 무작위 섞기
2. 1지망부터 순서대로 정원이 있는 학생 배치
3. 2지망, 3지망 순서로 미배치 학생 배치
4. 3지망까지 실패한 학생은 남은 정원이 있는 프로그램에 랜덤 배치 (choiceRank: 0)
5. 모든 학생 100% 배치 보장 (총 정원이 학생 수보다 많을 경우)

## 학생별 메시지 시스템
배치 결과 조회 시 각 학생에게 전달할 메시지 자동 생성:
- **1지망**: "축하합니다! 1지망에 배치되었습니다."
- **2지망**: "2지망에 배치되었습니다. 1지망 프로그램의 경쟁률이 높아 양해 부탁드립니다. (전체 학생 중 X%가 2지망에 배치됨)"
- **3지망**: "3지망에 배치되었습니다. 1-2지망 프로그램의 경쟁률이 높아 양해 부탁드립니다. (전체 학생 중 X%가 3지망에 배치됨)"
- **지망 외**: "지망하신 프로그램(1-3지망)의 정원이 모두 마감되어 다른 프로그램에 배치되었습니다. 양해 부탁드립니다. (전체 학생 중 X%가 지망 외 프로그램에 배치됨)"

## 최근 변경사항
- 2025-11-15: 배치 알고리즘 개선 (3지망 실패 시 랜덤 배치)
- 2025-11-15: 학생별 메시지 시스템 추가 (choiceRankText, message, successRate)
- 2025-11-15: 배치 수정 API 정원 체크 제거
- 2025-11-15: 진로체험활동 프로그램 18개 샘플 데이터 추가
- 2025-01-15: 프로젝트 초기 설정 및 문서 작성
