# PRD - 학생 프로그램 신청 및 배치 시스템 (백엔드 API 서버)

## 🎯 프로젝트 목표
해커톤용 학생 프로그램 신청 및 배치 시스템의 **백엔드 API 서버**입니다.
- 구글 폼 없이 웹에서 바로 프로그램 신청/배치를 처리
- **클라이언트는 별도 프로젝트로 분리**되어 있으며, 이 프로젝트는 순수 API만 제공
- Production URL: `https://class-matching-server.replit.app`

---

## 📋 프로젝트 범위

### ✅ 포함 범위 (구현 완료)
1. **프로그램 관리 API**
   - 프로그램 등록/조회/삭제
   
2. **학생 신청 API**
   - 최초 제출: 학번 + 이름만 필수
   - 중복 제출: 전화번호 + 생년월일 추가 필수
   - submission_count 자동 업데이트
   
3. **개선된 배치 API**
   - 자동 배치 알고리즘 (100% 배치 보장)
   - 학생별 맞춤 메시지 생성
   - 개별 배치 수정 (정원 무시)
   - 배치 결과 조회
   - CSV 다운로드

### ⛔ 제외 범위
- 프론트엔드 UI (별도 프로젝트)
- 구글 폼/스프레드시트 연동
- 인증/로그인 시스템
- AI 기반 배치 알고리즘

---

## 🔑 핵심 기능

### 1. 프로그램 관리
- 프로그램 등록 (이름, 유형, 정원, 설명)
- 프로그램 목록 조회
- 프로그램 삭제

### 2. 학생 신청
- **최초 제출**: 학번 + 이름 + 1~3지망 선택
- **중복 제출**: 전화번호 + 생년월일 추가 입력 후 재제출 가능
- 제출 횟수 자동 추적 (submission_count)

### 3. 배치 시스템

#### 개선된 배치 알고리즘
1. 학생 무작위 섞기
2. 1지망부터 순서대로 정원이 있는 학생 배치
3. 2지망, 3지망 순서로 미배치 학생 배치
4. **3지망까지 실패한 학생은 남은 정원 프로그램에 랜덤 배치**
5. 모든 학생 100% 배치 보장 (총 정원 충분 시)

#### 학생별 메시지 시스템
배치 결과 조회 시 각 학생에게 전달할 메시지 자동 생성:
- **1지망**: "축하합니다! 1지망에 배치되었습니다."
- **2지망**: "2지망에 배치되었습니다. 1지망 프로그램의 경쟁률이 높아 양해 부탁드립니다. (전체 학생 중 X%가 2지망에 배치됨)"
- **3지망**: "3지망에 배치되었습니다. 1-2지망 프로그램의 경쟁률이 높아 양해 부탁드립니다. (전체 학생 중 X%가 3지망에 배치됨)"
- **지망 외**: "지망하신 프로그램(1-3지망)의 정원이 모두 마감되어 다른 프로그램에 배치되었습니다. 양해 부탁드립니다. (전체 학생 중 X%가 지망 외 프로그램에 배치됨)"

#### 배치 결과 관리
- 배치 결과 조회 (학생명, 프로그램명, 지망, 메시지, 성공률 포함)
- 개별 배치 수정 (**정원 체크 없음** - 유연한 조정 가능)
- CSV 다운로드 (UTF-8 BOM 포함)

---

## 📊 데이터 모델

### programs (프로그램)
- 이름, 유형, 정원, 설명

### applications (신청)
- 학번 (UNIQUE), 이름
- 전화번호, 생년월일
- 1지망, 2지망, 3지망
- 제출 횟수, 최초 제출일시, 최근 제출일시

### allocations (배치)
- 학번, 프로그램 ID
- 지망 순위 (0: 지망 외, 1~3: 해당 지망)
- 배치 유형 (자동배치/수동배치)
- 배치 일시

---

## 🎯 성공 지표

### MVP 목표
- ✅ 프로그램 등록 기능
- ✅ 학생 신청/재신청 기능
- ✅ 중복 제출 검증
- ✅ 100% 배치 달성 (총 정원 충분 시)
- ✅ 교사용 CSV 다운로드
- ✅ 학생별 맞춤 메시지 제공

### 테스트 결과
- 18개 프로그램, 총 정원 220명
- 80명 학생 테스트: 97.5% 1지망 배치 성공
- 남은 정원 활용한 100% 배치 달성

---

## 🚀 배포 환경
- **플랫폼**: Replit
- **Production URL**: https://class-matching-server.replit.app
- **데이터베이스**: PostgreSQL (Replit 제공)
- **CORS**: 모든 origin 허용 (클라이언트 분리 구조)

---

## 📝 API 문서
자세한 API 사용법은 `test/CLIENT_API_REFERENCE.md` 참조
